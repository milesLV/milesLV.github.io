"0","tedsd_2021 %>%"
"0","  mutate(LOS = as.numeric(LOS), "
"0","         LOS = cut(LOS,"
"0","                   breaks = c(0, 30, 32, 37),"
"0","                   labels = c(""Under 1 month"", ""30-90 days"", ""Over 90 days""),"
"0","                   include.lowest = TRUE,"
"0","                   right = TRUE"
"0","         )"
"0","  ) %>%"
"0","  mutate(LIVARAG_delta = case_when("
"0","    LIVARAG == ""Unhoused"" & LIVARAG_D == ""Unhoused"" ~ ""Same"","
"0","    LIVARAG == ""Unhoused"" & LIVARAG_D == ""Dependent Living"" ~ ""Improved"","
"0","    LIVARAG == ""Unhoused"" & LIVARAG_D == ""Independent Living"" ~ ""Improved"","
"0","    LIVARAG == ""Dependent Living"" & LIVARAG_D == ""Unhoused"" ~ ""Worse"","
"0","    LIVARAG == ""Dependent Living"" & LIVARAG_D == ""Dependent Living"" ~ ""Same"","
"0","    LIVARAG == ""Dependent Living"" & LIVARAG_D == ""Independent Living"" ~ ""Improved"","
"0","    LIVARAG == ""Independent Living"" & LIVARAG_D == ""Unhoused"" ~ ""Worse"","
"0","    LIVARAG == ""Independent Living"" & LIVARAG_D == ""Dependent Living"" ~ ""Worse"","
"0","    LIVARAG == ""Independent Living"" & LIVARAG_D == ""Independent Living"" ~ ""Same"""
"0","  )) %>%"
"0","  count(LOS, LIVARAG_delta) %>%"
"0","  group_by(LOS) %>%"
"0","  mutate(proportion = n / sum(n)) %>%"
"0","  mutate(LIVARAG_delta = factor(LIVARAG_delta, levels = c(""Worse"", ""Same"", ""Improved""))) %>%"
"0","  ggplot(aes(x = LOS, y = proportion, fill = LIVARAG_delta)) +"
"0","    geom_bar(stat = ""identity"", position = ""fill"") +"
"0","    geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),"
"0","              position = position_fill(vjust = 0.5), size = 5, fontface = ""bold"") +"
"0","    labs(title = ""Impact of Length of Stay on Living Situation"","
"0","         subtitle = ""Among Substance Use Patients in Public Facilities (2021)"","
"0","         x = ""Length of Stay"","
"0","         y = ""Percentage of Patients"","
"0","         fill = ""Living Arrangement Change"") +"
"0","    scale_fill_manual(values = c(""Improved"" = ""darkgreen"", ""Same"" = ""gray"", ""Worse"" = ""red"")) +"
"0","    theme_classic() +"
"0","    theme(legend.position = ""bottom"","
"0","          axis.text.y = element_blank(),"
"0","          axis.ticks.y = element_blank(),"
"0","          plot.title = element_text(face = ""bold"", size = 14, hjust = 0.5),"
"0","          plot.subtitle = element_text(face = ""italic"", hjust = 0.5, size = 11),"
"0","          axis.title.x = element_text(size = 14, face = ""bold""),"
"0","          axis.text.x = element_text(size = 12, face = ""bold""))"
